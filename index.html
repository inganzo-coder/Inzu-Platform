<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>INZU Platform ‚Äì Scheduler, MbazaDi & Hotels</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --bg: #f9fafb;
      --text: #1f2937;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --fake-border: #ef4444;
      --real-border: #10b981;
    }
    html.dark {
      --bg: #1f2937;
      --text: #f9fafb;
    }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .results {
      margin-top: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 0.5rem;
      transition: background-color 0.3s ease;
    }
    html.dark .results {
      background: #374151;
      color: #f9fafb;
    }
    .results.likely-fake {
      border-left: 6px solid var(--fake-border);
    }
    .results.likely-real {
      border-left: 6px solid var(--real-border);
    }
    .hotel-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .hotel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .modal {
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="text-gray-800 dark:text-gray-200">
  <div class="container mx-auto p-6">
    <div class="flex justify-between mb-6">
      <h1 class="text-2xl font-bold">INZU Platform</h1>
      <div class="flex gap-2 items-center">
        <div id="authSection">
          <button id="loginBtn" class="px-3 py-1 bg-blue-500 text-white rounded">Login</button>
          <button id="signupBtn" class="px-3 py-1 bg-green-500 text-white rounded">Sign Up</button>
          <div id="userInfo" class="hidden">
            <span id="usernameDisplay"></span>
            <button id="logoutBtn" class="px-3 py-1 bg-red-500 text-white rounded">Logout</button>
          </div>
        </div>
        <label for="langToggle">üåç</label>
        <select id="langToggle" onchange="setMbazaLang(this.value)" class="bg-gray-200 dark:bg-gray-700 rounded px-2 py-1">
          <option value="en">EN</option>
          <option value="rw">RW</option>
        </select>
        <button onclick="document.documentElement.classList.toggle('dark')" class="ml-2 px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded">üåô</button>
      </div>
    </div>

    <ul class="flex border-b">
      <li><button onclick="showTab('scheduler')" class="px-4 py-2 font-semibold text-blue-500 border-b-2 border-blue-500" id="tab-scheduler">Scheduler</button></li>
      <li><button onclick="showTab('mbaza')" class="px-4 py-2 font-semibold" id="tab-mbaza">Fake News Detector</button></li>
      <li><button onclick="showTab('hotels')" class="px-4 py-2 font-semibold" id="tab-hotels">Hotels</button></li>
      <li><button onclick="showTab('bookings')" class="px-4 py-2 font-semibold" id="tab-bookings">My Bookings</button></li>
    </ul>

    <div id="panel-scheduler" class="mt-6">
      <div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4"><i class="fas fa-calendar-alt text-blue-500"></i> INZU Rwanda Scheduler</h2>
        <form id="schedulerForm" class="space-y-6">
          <div>
            <label for="title" class="block font-medium">Appointment Title</label>
            <input type="text" id="title" required class="w-full px-3 py-2 border dark:border-gray-600 dark:bg-gray-700 rounded" placeholder="e.g. Team meeting">
          </div>
          <div>
            <label for="date" class="block font-medium">Date</label>
            <input type="date" id="date" required class="w-full px-3 py-2 border dark:border-gray-600 dark:bg-gray-700 rounded">
          </div>
          <div>
            <label for="time" class="block font-medium">Time</label>
            <input type="time" id="time" required class="w-full px-3 py-2 border dark:border-gray-600 dark:bg-gray-700 rounded">
          </div>
          <div>
            <label for="attendees" class="block font-medium">Attendees (comma-separated emails)</label>
            <input type="text" id="attendees" class="w-full px-3 py-2 border dark:border-gray-600 dark:bg-gray-700 rounded" placeholder="example@inzu.rw, test@example.com">
          </div>
          <div>
            <label for="ussdOption" class="block font-medium">USSD Option</label>
            <select id="ussdOption" class="w-full px-3 py-2 border dark:border-gray-600 dark:bg-gray-700 rounded">
              <option value="1">1. Book Health Appointment</option>
              <option value="2">2. Schedule Transport</option>
              <option value="3">3. Community Meeting</option>
              <option value="4">4. Book Accommodation</option>
              <option value="5">5. View Bookings</option>
              <option value="0">0. Exit</option>
            </select>
          </div>
          <div>
            <label class="block font-medium mb-2">Listings</label>
            <div class="grid grid-cols-2 gap-4" id="listingOptions">
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Gorilla Trekking" /> Gorilla Trekking</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Lake Kivu" /> Lake Kivu</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Kigali" /> Kigali</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Coffee Tours" /> Coffee Tours</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Cultural Village" /> Cultural Village</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Tea Plantations" /> Tea Plantations</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Nyungwe Forest" /> Nyungwe Forest</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="WiFi" /> WiFi</label>
              <label class="flex items-center"><input type="checkbox" class="mr-2" value="Meals Included" /> Meals Included</label>
            </div>
          </div>
          <div>
            <button type="button" onclick="previewSchedule()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded mr-2">Preview Summary</button>
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Schedule Appointment</button>
          </div>
        </form>
        <div id="previewBox" class="mt-4 p-4 border rounded bg-gray-50 dark:bg-gray-700 hidden"></div>
      </div>
    </div>

    <div id="panel-mbaza" class="mt-6 hidden">
      <div id="mbazaDiRoot"></div>
    </div>

    <div id="panel-hotels" class="mt-6 hidden">
      <div id="hotelsRoot"></div>
    </div>

    <div id="panel-bookings" class="mt-6 hidden">
      <div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4"><i class="fas fa-bookmark text-blue-500"></i> My Bookings</h2>
        <div id="bookingsList" class="space-y-4"></div>
      </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold">Complete Payment</h3>
          <button onclick="closePaymentModal()" class="text-gray-500 hover:text-gray-700">√ó</button>
        </div>
        <div id="paymentContent"></div>
      </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold">Login</h3>
          <button onclick="closeAuthModal('loginModal')" class="text-gray-500 hover:text-gray-700">√ó</button>
        </div>
        <form id="loginForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Email</label>
            <input type="email" id="loginEmail" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Password</label>
            <input type="password" id="loginPassword" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">Login</button>
        </form>
      </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold">Sign Up</h3>
          <button onclick="closeAuthModal('signupModal')" class="text-gray-500 hover:text-gray-700">√ó</button>
        </div>
        <form id="signupForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Username</label>
            <input type="text" id="signupUsername" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Email</label>
            <input type="email" id="signupEmail" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Password</label>
            <input type="password" id="signupPassword" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded">Sign Up</button>
        </form>
      </div>
    </div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const translations = {
      en: {
        title: "Fake News Detector",
        analyze: "Analyze",
        result: "Result",
        verdict: "Verdict",
        confidence: "Confidence",
        contentType: "Content Type",
        likelyFake: "Likely Fake",
        likelyReal: "Likely Real",
        copy: "Copy Result",
        whatsappNumber: "WhatsApp Number",
        sendWhatsApp: "Send to WhatsApp"
      },
      rw: {
        title: "Ubugenzuzi bw'Amakuru y'Ibinyoma",
        analyze: "Sobanura",
        result: "Ibisubizo",
        verdict: "Icyemezo",
        confidence: "Icyizere",
        contentType: "Ubwoko bw'Amakuru",
        likelyFake: "Birashoboka ko ari Ibinyoma",
        likelyReal: "Birashoboka ko ari Ukuri",
        copy: "Koporora Ibisubizo",
        whatsappNumber: "Nimero ya WhatsApp",
        sendWhatsApp: "Kohereza kuri WhatsApp"
      }
    };

    // Hotel data with availability
    const hotels = [
      {
        id: 1,
        name: "Kigali Serena Hotel",
        location: "Kigali",
        rating: 5,
        price: 180,
        image: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400",
        amenities: ["WiFi", "Pool", "Spa", "Restaurant", "Gym"],
        description: "Luxury hotel in the heart of Kigali with panoramic city views.",
        availability: [
          { date: "2025-06-15", rooms: 10 },
          { date: "2025-06-16", rooms: 8 },
          { date: "2025-06-17", rooms: 5 }
        ]
      },
      {
        id: 2,
        name: "Volcanoes Safaris Mount Gahinga Lodge",
        location: "Mgahinga",
        rating: 4,
        price: 320,
        image: "https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?w=400",
        amenities: ["WiFi", "Restaurant", "Bar", "Garden", "Fireplace"],
        description: "Eco-lodge near Volcanoes National Park, perfect for gorilla trekking.",
        availability: [
          { date: "2025-06-15", rooms: 6 },
          { date: "2025-06-16", rooms: 4 },
          { date: "2025-06-17", rooms: 3 }
        ]
      },
      {
        id: 3,
        name: "Lake Kivu Serena Hotel",
        location: "Gisenyi",
        rating: 4,
        price: 145,
        image: "https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=400",
        amenities: ["WiFi", "Beach Access", "Restaurant", "Bar", "Water Sports"],
        description: "Beachfront hotel on the shores of beautiful Lake Kivu.",
        availability: [
          { date: "2025-06-15", rooms: 12 },
          { date: "2025-06-16", rooms: 10 },
          { date: "2025-06-17", rooms: 8 }
        ]
      },
      {
        id: 4,
        name: "Nyungwe Forest Lodge",
        location: "Nyungwe",
        rating: 5,
        price: 280,
        image: "https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=400",
        amenities: ["WiFi", "Restaurant", "Spa", "Forest Tours", "Tea Tasting"],
        description: "Luxury eco-lodge in the heart of Nyungwe National Park.",
        availability: [
          { date: "2025-06-15", rooms: 7 },
          { date: "2025-06-16", rooms: 5 },
          { date: "2025-06-17", rooms: 4 }
        ]
      },
      {
        id: 5,
        name: "The Retreat by Heaven",
        location: "Kigali",
        rating: 4,
        price: 95,
        image: "https://images.unsplash.com/photo-1578683010236-d716f9a3f461?w=400",
        amenities: ["WiFi", "Pool", "Restaurant", "Garden", "Conference Room"],
        description: "Boutique hotel with modern amenities and tranquil atmosphere.",
        availability: [
          { date: "2025-06-15", rooms: 15 },
          { date: "2025-06-16", rooms: 12 },
          { date: "2025-06-17", rooms: 10 }
        ]
      },
      {
        id: 6,
        name: "Ubuki Lodge",
        location: "Lake Burera",
        rating: 3,
        price: 75,
        image: "https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?w=400",
        amenities: ["WiFi", "Restaurant", "Bar", "Lake Views", "Boat Tours"],
        description: "Scenic lodge overlooking the twin lakes with stunning mountain views.",
        availability: [
          { date: "2025-06-15", rooms: 8 },
          { date: "2025-06-16", rooms: 6 },
          { date: "2025-06-17", rooms: 5 }
        ]
      }
    ];

    function MbazaApp() {
      const [input, setInput] = React.useState('');
      const [result, setResult] = React.useState(null);
      const [lang, setLang] = React.useState('en');
      const [whatsappNumber, setWhatsappNumber] = React.useState('');

      const t = (key) => translations[lang][key] || key;

      const analyze = () => {
        if (!input.trim()) return;
        const lower = input.toLowerCase();
        const fakeWords = ['fake', 'hoax', 'conspiracy'];
        const isFake = fakeWords.some(w => lower.includes(w));
        const confidence = (50 + Math.random() * 50).toFixed(2);
        setResult({
          verdict: isFake ? t('likelyFake') : t('likelyReal'),
          confidence,
          contentType: 'News'
        });
      };

      const sendToWhatsApp = () => {
        if (!result || !whatsappNumber.trim()) return;
        
        const message = encodeURIComponent(`
üîç *INZU Fake News Analysis Report*

üìù *Analyzed Content:* ${input.substring(0, 100)}${input.length > 100 ? '...' : ''}

üìä *Results:*
‚Ä¢ *${t('verdict')}:* ${result.verdict}
‚Ä¢ *${t('confidence')}:* ${result.confidence}%
‚Ä¢ *${t('contentType')}:* ${result.contentType}

‚è∞ *Analysis Date:* ${new Date().toLocaleString()}

---
Generated by INZU Platform - MbazaDi Fake News Detector
        `);

        const cleanNumber = whatsappNumber.replace(/\D/g, '');
        const whatsappUrl = `https://wa.me/${cleanNumber}?text=${message}`;
        
        window.open(whatsappUrl, '_blank');
      };

      React.useEffect(() => {
        window.setMbazaLang = (newLang) => {
          setLang(newLang);
        }
      }, []);

      return (
        <div className="bg-white dark:bg-gray-800 p-6 rounded shadow">
          <h2 className="text-xl font-bold mb-4 text-gray-900 dark:text-gray-100">{t('title')}</h2>
          <textarea
            className="w-full p-3 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"
            rows="4"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="Paste news text here..."
          />
          
          <div className="mt-3 flex flex-col sm:flex-row gap-3">
            <input
              type="tel"
              className="flex-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"
              value={whatsappNumber}
              onChange={(e) => setWhatsappNumber(e.target.value)}
              placeholder={`${t('whatsappNumber')} (e.g., +250788123456)`}
            />
            <button
              onClick={analyze}
              className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors"
            >{t('analyze')}</button>
          </div>

          {result && (
            <div className={`results mt-4 ${result.verdict === t('likelyFake') ? 'likely-fake' : 'likely-real'}`}>
              <h3 className="font-bold text-gray-900 dark:text-gray-100">{t('result')}</h3>
              <p className="text-gray-800 dark:text-gray-200"><strong>{t('verdict')}:</strong> {result.verdict}</p>
              <p className="text-gray-800 dark:text-gray-200"><strong>{t('confidence')}:</strong> {result.confidence}%</p>
              <p className="text-gray-800 dark:text-gray-200"><strong>{t('contentType')}:</strong> {result.contentType}</p>
              <div className="mt-3 flex flex-col sm:flex-row gap-2">
                <button
                  onClick={() => navigator.clipboard.writeText(
                    `${t('verdict')}: ${result.verdict}\n${t('confidence')}: ${result.confidence}%`
                  )}
                  className="text-blue-600 dark:text-blue-400 hover:underline transition-colors"
                >{t('copy')}</button>
                <button
                  onClick={sendToWhatsApp}
                  disabled={!whatsappNumber.trim()}
                  className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-3 py-1 rounded text-sm transition-colors"
                >{t('sendWhatsApp')}</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    function HotelsApp() {
      const [selectedHotel, setSelectedHotel] = React.useState(null);
      const [searchTerm, setSearchTerm] = React.useState('');
      const [priceRange, setPriceRange] = React.useState([0, 500]);
      const [selectedLocation, setSelectedLocation] = React.useState('');
      const [checkIn, setCheckIn] = React.useState('');
      const [checkOut, setCheckOut] = React.useState('');
      const [guests, setGuests] = React.useState(1);

      const locations = [...new Set(hotels.map(h => h.location))];
      
      const filteredHotels = hotels.filter(hotel => {
        return hotel.name.toLowerCase().includes(searchTerm.toLowerCase()) &&
               hotel.price >= priceRange[0] && hotel.price <= priceRange[1] &&
               (selectedLocation === '' || hotel.location === selectedLocation);
      });

      const bookHotel = (hotel) => {
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) {
          alert('Please log in to book a hotel');
          return;
        }

        if (!checkIn || !checkOut) {
          alert('Please select check-in and check-out dates');
          return;
        }

        // Check availability
        const startDate = new Date(checkIn);
        const endDate = new Date(checkOut);
        let isAvailable = true;
        const dates = [];
        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
          const dateStr = d.toISOString().split('T')[0];
          const availability = hotel.availability.find(a => a.date === dateStr);
          if (!availability || availability.rooms <= 0) {
            isAvailable = false;
            break;
          }
          dates.push(dateStr);
        }

        if (!isAvailable) {
          alert('Selected dates are not available for this hotel.');
          return;
        }

        // Update availability (simulate booking)
        dates.forEach(date => {
          const availability = hotel.availability.find(a => a.date === date);
          if (availability) availability.rooms -= 1;
        });

        setSelectedHotel(hotel);
        showPaymentModal(hotel);
      };

      return (
        <div className="bg-white dark:bg-gray-800 p-6 rounded shadow">
          <h2 className="text-xl font-bold mb-6 text-gray-900 dark:text-gray-100">
            <i className="fas fa-hotel text-blue-500 mr-2"></i>
            Rwanda Hotels & Accommodation
          </h2>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <input
              type="text"
              placeholder="Search hotels..."
              className="p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
            <select
              className="p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
              value={selectedLocation}
              onChange={(e) => setSelectedLocation(e.target.value)}
            >
              <option value="">All Locations</option>
              {locations.map(loc => (
                <option key={loc} value={loc}>{loc}</option>
              ))}
            </select>
            <input
              type="date"
              className="p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
              value={checkIn}
              onChange={(e) => setCheckIn(e.target.value)}
              placeholder="Check-in"
            />
            <input
              type="date"
              className="p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
              value={checkOut}
              onChange={(e) => setCheckOut(e.target.value)}
              placeholder="Check-out"
            />
          </div>

          <div className="flex items-center gap-4 mb-6">
            <label className="flex items-center gap-2">
              <span>Guests:</span>
              <select 
                className="p-1 border rounded dark:bg-gray-700 dark:border-gray-600"
                value={guests}
                onChange={(e) => setGuests(parseInt(e.target.value))}
              >
                {[1,2,3,4,5,6].map(n => (
                  <option key={n} value={n}>{n}</option>
                ))}
              </select>
            </label>
            <label className="flex items-center gap-2">
              <span>Max Price: ${priceRange[1]}</span>
              <input
                type="range"
                min="0"
                max="500"
                value={priceRange[1]}
                onChange={(e) => setPriceRange([0, parseInt(e.target.value)])}
                className="w-24"
              />
            </label>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredHotels.map(hotel => (
              <div key={hotel.id} className="hotel-card bg-gray-50 dark:bg-gray-700 rounded-lg overflow-hidden shadow">
                <img 
                  src={hotel.image} 
                  alt={hotel.name}
                  className="w-full h-48 object-cover"
                />
                <div className="p-4">
                  <div className="flex justify-between items-start mb-2">
                    <h3 className="font-bold text-lg">{hotel.name}</h3>
                    <div className="flex items-center text-yellow-400">
                      {[...Array(hotel.rating)].map((_, i) => (
                        <i key={i} className="fas fa-star text-sm"></i>
                      ))}
                    </div>
                  </div>
                  <p className="text-gray-600 dark:text-gray-300 text-sm mb-2">
                    <i className="fas fa-map-marker-alt mr-1"></i>
                    {hotel.location}
                  </p>
                  <p className="text-gray-600 dark:text-gray-300 text-sm mb-3">
                    {hotel.description}
                  </p>
                  <div className="flex flex-wrap gap-1 mb-3">
                    {hotel.amenities.slice(0, 3).map(amenity => (
                      <span key={amenity} className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded">
                        {amenity}
                      </span>
                    ))}
                    {hotel.amenities.length > 3 && (
                      <span className="text-xs text-gray-500">+{hotel.amenities.length - 3} more</span>
                    )}
                  </div>
                  <div className="flex justify-between items-center">
                    <div>
                      <span className="text-2xl font-bold text-green-600">${hotel.price}</span>
                      <span className="text-gray-500 text-sm">/night</span>
                    </div>
                    <button
                      onClick={() => bookHotel(hotel)}
                      className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors"
                    >
                      Book Now
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>

          {filteredHotels.length === 0 && (
            <div className="text-center py-8 text-gray-500">
              <i className="fas fa-search text-4xl mb-4"></i>
              <p>No hotels found matching your criteria</p>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("mbazaDiRoot")).render(<MbazaApp />);
    ReactDOM.createRoot(document.getElementById("hotelsRoot")).render(<HotelsApp />);
  </script>

  <script>
    // Initialize EmailJS
    (function() {
      emailjs.init("YOUR_PUBLIC_KEY"); // Replace with your EmailJS public key
    })();

    // Authentication Logic
    function initializeAuth() {
      const loginBtn = document.getElementById('loginBtn');
      const signupBtn = document.getElementById('signupBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      const userInfo = document.getElementById('userInfo');
      const usernameDisplay = document.getElementById('usernameDisplay');
      const loginModal = document.getElementById('loginModal');
      const signupModal = document.getElementById('signupModal');
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');

      // Check if user is already logged in
      const currentUser = localStorage.getItem('currentUser');
      if (currentUser) {
        loginBtn.classList.add('hidden');
        signupBtn.classList.add('hidden');
        userInfo.classList.remove('hidden');
        usernameDisplay.textContent = JSON.parse(localStorage.getItem('users') || '{}')[currentUser]?.username || 'User';
      }

      loginBtn.addEventListener('click', () => {
        loginModal.classList.remove('hidden');
      });

      signupBtn.addEventListener('click', () => {
        signupModal.classList.remove('hidden');
      });

      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('currentUser');
        loginBtn.classList.remove('hidden');
        signupBtn.classList.remove('hidden');
        userInfo.classList.add('hidden');
        alert('Logged out successfully!');
        showTab('scheduler'); // Reset to default tab
      });

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        
        if (users[email] && users[email].password === password) {
          localStorage.setItem('currentUser', email);
          loginModal.classList.add('hidden');
          loginBtn.classList.add('hidden');
          signupBtn.classList.add('hidden');
          userInfo.classList.remove('hidden');
          usernameDisplay.textContent = users[email].username;
          alert('Login successful!');
        } else {
          alert('Invalid email or password');
        }
      });

      signupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('signupUsername').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        
        if (users[email]) {
          alert('Email already registered');
          return;
        }

        users[email] = { username, password };
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.setItem('currentUser', email);
        signupModal.classList.add('hidden');
        loginBtn.classList.add('hidden');
        signupBtn.classList.add('hidden');
        userInfo.classList.remove('hidden');
        usernameDisplay.textContent = username;
        alert('Sign up successful!');
      });
    }

    function closeAuthModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    function showTab(tab) {
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser && ['scheduler', 'hotels', 'bookings'].includes(tab)) {
        alert('Please log in to access this feature');
        document.getElementById('loginModal').classList.remove('hidden');
        return;
      }

      const tabs = ['scheduler', 'mbaza', 'hotels', 'bookings'];
      tabs.forEach(t => {
        document.getElementById(`panel-${t}`).classList.add("hidden");
        document.getElementById(`tab-${t}`).classList.remove("text-blue-500", "border-b-2", "border-blue-500");
      });
      document.getElementById(`panel-${tab}`).classList.remove("hidden");
      document.getElementById(`tab-${tab}`).classList.add("text-blue-500", "border-b-2", "border-blue-500");

      if (tab === 'bookings') {
        displayBookings();
      }
    }

    function displayBookings() {
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser) {
        document.getElementById('bookingsList').innerHTML = '<p class="text-gray-500">Please log in to view your bookings.</p>';
        return;
      }

      const bookings = JSON.parse(localStorage.getItem('hotelBookings') || '[]')
        .filter(booking => booking.userId === currentUser);
      const appointments = JSON.parse(localStorage.getItem('appointments') || '[]')
        .filter(appointment => appointment.userId === currentUser);

      let html = '';
      if (bookings.length === 0 && appointments.length === 0) {
        html = '<p class="text-gray-500">No bookings or appointments found.</p>';
      } else {
        bookings.forEach(booking => {
          html += `
            <div class="p-4 border rounded bg-gray-50 dark:bg-gray-700">
              <h3 class="font-bold">${booking.hotel}</h3>
              <p>Amount: $${booking.amount}</p>
              <p>Check-in: ${booking.checkIn}</p>
              <p>Check-out: ${booking.checkOut}</p>
              <p>Guests: ${booking.guests}</p>
              <p>Booked on: ${new Date(booking.timestamp).toLocaleString()}</p>
            </div>
          `;
        });
        appointments.forEach(appointment => {
          html += `
            <div class="p-4 border rounded bg-gray-50 dark:bg-gray-700">
              <h3 class="font-bold">${appointment.title}</h3>
              <p>Date: ${appointment.date}</p>
              <p>Time: ${appointment.time}</p>
              <p>Attendees: ${appointment.attendees || 'None'}</p>
              <p>Listings: ${appointment.listings.join(', ') || 'None'}</p>
              <p>Scheduled on: ${new Date(appointment.timestamp).toLocaleString()}</p>
            </div>
          `;
        });
      }

      document.getElementById('bookingsList').innerHTML = html;
    }

    function showPaymentModal(hotel) {
      const modal = document.getElementById('paymentModal');
      const content = document.getElementById('paymentContent');
      
      const checkIn = document.querySelector('#panel-hotels input[type="date"]').value;
      const checkOut = document.querySelector('#panel-hotels input[type="date"]:nth-of-type(2)').value;
      const nights = checkIn && checkOut ? Math.ceil((new Date(checkOut) - new Date(checkIn)) / (1000 * 60 * 60 * 24)) : 1;
      const total = hotel.price * nights;
      
      content.innerHTML = `
        <div class="mb-4">
          <h4 class="font-bold text-lg mb-2">${hotel.name}</h4>
          <p class="text-gray-600 dark:text-gray-300">
            <i class="fas fa-calendar mr-1"></i>
            ${checkIn || 'TBD'} - ${checkOut || 'TBD'} (${nights} night${nights > 1 ? 's' : ''})
          </p>
          <p class="text-2xl font-bold text-green-600 mt-2">$${total}</p>
        </div>
        
        <form id="paymentForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Payment Method</label>
            <select class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
              <option value="">Select Payment Method</option>
              <option value="momo">MTN Mobile Money</option>
              <option value="airtel">Airtel Money</option>
              <option value="card">Credit/Debit Card</option>
              <option value="bank">Bank Transfer</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Full Name</label>
            <input type="text" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Phone Number</label>
            <input type="tel" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" placeholder="+250787922584" required>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Email</label>
            <input type="email" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required>
          </div>
          
          <div class="flex gap-2 pt-4">
            <button type="button" onclick="closePaymentModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded transition-colors">
              Cancel
            </button>
            <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded transition-colors">
              Pay $${total}
            </button>
          </div>
        </form>
      `;
      
      modal.classList.remove('hidden');
      
      document.getElementById('paymentForm').onsubmit = (e) => {
        e.preventDefault();
        processPayment(hotel, total);
      };
    }

    function closePaymentModal() {
      document.getElementById('paymentModal').classList.add('hidden');
    }

    function generateBookingPDF(hotelName, amount, checkIn, checkOut, guests) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(16);
      doc.text("INZU Platform - Hotel Booking Confirmation", 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Hotel: ${hotelName}`, 20, 40);
      doc.text(`Amount Paid: $${amount}`, 20, 50);
      doc.text(`Check-in: ${checkIn || 'TBD'}`, 20, 60);
      doc.text(`Check-out: ${checkOut || 'TBD'}`, 20, 70);
      doc.text(`Guests: ${guests}`, 20, 80);
      doc.text(`Booking Date: ${new Date().toLocaleDateString()}`, 20, 90);
      doc.text(`Confirmation Number: INZ${Date.now()}`, 20, 100);
      
      doc.text("Thank you for booking with INZU Platform!", 20, 120);
      doc.text("Contact: ewpmagazine7@gmail.com", 20, 130);
      doc.text("Phone: +250 787 922 584", 20, 140);
      
      doc.save(`INZU_Booking_Confirmation_${Date.now()}.pdf`);
    }

    function generateAppointmentPDF(data) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const ussdOptions = {
        '1': '1. Book Health Appointment',
        '2': '2. Schedule Transport',
        '3': '3. Community Meeting',
        '4': '4. Book Accommodation',
        '5': '5. View Bookings',
        '0': '0. Exit'
      };
      
      doc.setFontSize(16);
      doc.text("INZU Platform - Appointment Confirmation", 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Title: ${data.title}`, 20, 40);
      doc.text(`Date: ${data.date}`, 20, 50);
      doc.text(`Time: ${data.time}`, 20, 60);
      doc.text(`Attendees: ${data.attendees || 'None specified'}`, 20, 70);
      doc.text(`USSD Option: ${ussdOptions[data.ussd] || 'Unknown'}`, 20, 80);
      doc.text(`Listings: ${data.listings.length > 0 ? data.listings.join(', ') : 'None'}`, 20, 90);
      doc.text(`Scheduled At: ${new Date().toLocaleString()}`, 20, 100);
      
      doc.text("Thank you for scheduling with INZU Platform!", 20, 120);
      doc.text("Contact: support@inzu.rw", 20, 130);
      doc.text("Phone: +250 788 123 456", 20, 140);
      
      doc.save(`INZU_Appointment_Confirmation_${Date.now()}.pdf`);
    }

    function processPayment(hotel, amount) {
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser) {
        alert('Please log in to book a hotel');
        return;
      }

      const checkIn = document.querySelector('#panel-hotels input[type="date"]').value;
      const checkOut = document.querySelector('#panel-hotels input[type="date"]:nth-of-type(2)').value;
      const guests = document.querySelector('#panel-hotels select').value;
      const email = document.querySelector('#paymentForm input[type="email"]').value;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!emailRegex.test(email)) {
        alert('Please enter a valid email address');
        return;
      }

      const paymentData = {
        hotel: hotel.name,
        amount: amount,
        checkIn,
        checkOut,
        guests,
        timestamp: new Date().toISOString(),
        status: 'confirmed',
        userId: currentUser
      };

      // Prepare mailto link
      const mailtoSubject = encodeURIComponent(`Hotel Booking Confirmation - ${hotel.name}`);
      const mailtoBody = encodeURIComponent(`
INZU Platform - Hotel Booking Confirmation

Hotel: ${hotel.name}
Amount Paid: $${amount}
Check-in: ${checkIn || 'TBD'}
Check-out: ${checkOut || 'TBD'}
Guests: ${guests}
Booking Date: ${new Date().toLocaleDateString()}
Confirmation Number: INZ${Date.now()}

Thank you for booking with INZU Platform!
Contact: support@inzu.rw
Phone: +250 788 123 456
      `);
      const mailtoLink = `mailto:ewpmagazine7@gmail.com?subject=${mailtoSubject}&body=${mailtoBody}`;

      // Show loading
      const paymentContent = document.getElementById('paymentContent');
      paymentContent.innerHTML = `
        <div class="text-center py-8">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
          <p>Processing payment...</p>
        </div>
      `;
      
      // Send confirmation email to ewpmagazine7@gmail.com
      emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', {
        hotel_name: hotel.name,
        amount: amount,
        check_in: checkIn,
        check_out: checkOut,
        guests: guests,
        booking_date: new Date().toLocaleDateString(),
        to_email: 'ewpmagazine7@gmail.com'
      }).then(() => {
        // Store booking data
        const bookings = JSON.parse(localStorage.getItem('hotelBookings') || '[]');
        bookings.push(paymentData);
        localStorage.setItem('hotelBookings', JSON.stringify(bookings));

        // Show success message with PDF and email options
        paymentContent.innerHTML = `
          <div class="text-center py-6">
            <div class="text-green-500 text-6xl mb-4">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 text-green-600">Payment Successful!</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              Your booking at ${hotel.name} has been confirmed.
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
              Confirmation details have been sent to ewpmagazine7@gmail.com.
            </p>
            <div class="flex flex-wrap gap-2 justify-center">
              <button onclick="generateBookingPDF('${hotel.name}', ${amount}, '${checkIn}', '${checkOut}', ${guests})" 
                      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-file-pdf mr-1"></i>
                Download PDF
              </button>
              <button onclick="window.open('${mailtoLink}', '_blank')" 
                      class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-envelope mr-1"></i>
                Send Email
              </button>
              <button onclick="downloadBookingConfirmation('${hotel.name}', ${amount})" 
                      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-download mr-1"></i>
                Download Text
              </button>
              <button onclick="closePaymentModal()" 
                      class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                Close
              </button>
            </div>
          </div>
        `;
      }).catch((error) => {
        console.error('EmailJS error:', error);
        paymentContent.innerHTML = `
          <div class="text-center py-6">
            <div class="text-red-500 text-6xl mb-4">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 text-red-600">Payment Saved Locally</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              Failed to send confirmation email. Booking saved locally.
            </p>
            <div class="flex flex-wrap gap-2 justify-center">
              <button onclick="generateBookingPDF('${hotel.name}', ${amount}, '${checkIn}', '${checkOut}', ${guests})" 
                      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-file-pdf mr-1"></i>
                Download PDF
              </button>
              <button onclick="window.open('${mailtoLink}', '_blank')" 
                      class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-envelope mr-1"></i>
                Send Email
              </button>
              <button onclick="closePaymentModal()" 
                      class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                Close
              </button>
            </div>
          </div>
        `;
        // Store booking data even on email failure
        const bookings = JSON.parse(localStorage.getItem('hotelBookings') || '[]');
        bookings.push(paymentData);
        localStorage.setItem('hotelBookings', JSON.stringify(bookings));
      });
    }

    function downloadBookingConfirmation(hotelName, amount) {
      const confirmationText = `
INZU PLATFORM - HOTEL BOOKING CONFIRMATION

Hotel: ${hotelName}
Amount Paid: $${amount}
Booking Date: ${new Date().toLocaleDateString()}
Confirmation Number: INZ${Date.now()}

Thank you for booking with INZU Platform!

Contact: support@inzu.rw
Phone: +250 788 123 456
      `;
      
      const blob = new Blob([confirmationText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `INZU_Booking_Confirmation_${Date.now()}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    const form = document.getElementById('schedulerForm');
    const previewBox = document.getElementById('previewBox');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = collectFormData();
      if (!formData) return; // Stop if validation fails
      
      // Show confirmation modal
      showConfirmationModal(formData);
    });

    function collectFormData() {
      const listings = Array.from(document.querySelectorAll('#listingOptions input:checked')).map(cb => cb.value);
      const attendees = document.getElementById('attendees').value;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const emails = attendees.split(',').map(email => email.trim()).filter(email => email);
      
      if (emails.length > 0 && !emails.every(email => emailRegex.test(email))) {
        alert('Please enter valid email addresses for attendees');
        return null;
      }

      return {
        title: document.getElementById('title').value,
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        attendees,
        ussd: document.getElementById('ussdOption').value,
        listings
      };
    }

    function showConfirmationModal(data) {
      // Remove existing confirmation modal if any
      const existingModal = document.getElementById('confirmationModal');
      if (existingModal) existingModal.remove();

      const modal = document.createElement('div');
      modal.id = 'confirmationModal';
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 modal flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-lg w-full mx-4">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold">Appointment Confirmation</h3>
            <button onclick="closeConfirmationModal()" class="text-gray-500 hover:text-gray-700">√ó</button>
          </div>
          <div id="confirmationContent" class="text-center py-6">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p>Scheduling appointment...</p>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // Send email and update modal content
      sendAppointmentEmail(data, () => {
        const ussdOptions = {
          '1': '1. Book Health Appointment',
          '2': '2. Schedule Transport',
          '3': '3. Community Meeting',
          '4': '4. Book Accommodation',
          '5': '5. View Bookings',
          '0': '0. Exit'
        };
        const mailtoSubject = encodeURIComponent(`Appointment Confirmation - ${data.title}`);
        const mailtoBody = encodeURIComponent(`
INZU Platform - Appointment Confirmation

Title: ${data.title}
Date: ${data.date}
Time: ${data.time}
Attendees: ${data.attendees || 'None specified'}
USSD Option: ${ussdOptions[data.ussd] || 'Unknown'}
Listings: ${data.listings.length > 0 ? data.listings.join(', ') : 'None'}
Scheduled At: ${new Date().toLocaleString()}

Thank you for scheduling with INZU Platform!
Contact: support@inzu.rw
Phone: +250 788 123 456
        `);
        const mailtoLink = `mailto:ewpmagazine7@gmail.com?subject=${mailtoSubject}&body=${mailtoBody}`;
        
        document.getElementById('confirmationContent').innerHTML = `
          <div class="text-center py-6">
            <div class="text-green-500 text-6xl mb-4">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 text-green-600">Appointment Scheduled!</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              Your appointment "${data.title}" has been confirmed.
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
              Confirmation details have been sent to ewpmagazine7@gmail.com.
            </p>
            <div class="flex flex-wrap gap-2 justify-center">
              <button onclick="generateAppointmentPDF(JSON.parse(\`${encodeURIComponent(JSON.stringify(data))}\'))" 
                      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-file-pdf mr-1"></i>
                Download PDF
              </button>
              <button onclick="window.open('${mailtoLink}', '_blank')" 
                      class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-envelope mr-1"></i>
                Send Email
              </button>
              <button onclick="closeConfirmationModal()" 
                      class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                Close
              </button>
            </div>
          </div>
        `;
      }, () => {
        // Error callback
        const mailtoSubject = encodeURIComponent(`Appointment Confirmation - ${data.title}`);
        const mailtoBody = encodeURIComponent(`
INZU Platform - Appointment Confirmation

Title: ${data.title}
Date: ${data.date}
Time: ${data.time}
Attendees: ${data.attendees || 'None specified'}
USSD Option: ${ussdOptions[data.ussd] || 'Unknown'}
Listings: ${data.listings.length > 0 ? data.listings.join(', ') : 'None'}
Scheduled At: ${new Date().toLocaleString()}

Thank you for scheduling with INZU Platform!
Contact: support@inzu.rw
Phone: +250 788 123 456
        `);
        const mailtoLink = `mailto:ewpmagazine7@gmail.com?subject=${mailtoSubject}&body=${mailtoBody}`;
        
        document.getElementById('confirmationContent').innerHTML = `
          <div class="text-center py-6">
            <div class="text-red-500 text-6xl mb-4">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 text-red-600">Appointment Saved Locally</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              Failed to send confirmation email. Appointment saved locally.
            </p>
            <div class="flex flex-wrap gap-2 justify-center">
              <button onclick="generateAppointmentPDF(JSON.parse(\`${encodeURIComponent(JSON.stringify(data))}\'))" 
                      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-file-pdf mr-1"></i>
                Download PDF
              </button>
              <button onclick="window.open('${mailtoLink}', '_blank')" 
                      class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                <i class="fas fa-envelope mr-1"></i>
                Send Email
              </button>
              <button onclick="closeConfirmationModal()" 
                      class="bg-gray-500 hover:bg-gray-600ÔºÜtext-white px-4 py-1 rounded transition-colors">
                Close
              </button>
            </div>
          </div>
        `;
      });
    }

    function closeConfirmationModal() {
      const modal = document.getElementById('confirmationModal');
      if (modal) modal.remove();
    }

    function sendAppointmentEmail(data, successCallback, errorCallback) {
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser) {
        alert('Please log in to schedule an appointment');
        closeConfirmationModal();
        return;
      }

      const ussdOptions = {
        '1': '1. Book Health Appointment',
        '2': '2. Schedule Transport',
        '3': '3. Community Meeting',
        '4': '4. Book Accommodation',
        '5': '5. View Bookings',
        '0': '0. Exit'
      };

      const templateParams = {
        title: data.title,
        date: data.date,
        time: data.time,
        attendees: data.attendees || 'None specified',
        ussd_option: ussdOptions[data.ussd] || '',
        listings: data.listings.length > 0 ? data.listings.join(', ') : 'None',
        scheduled_at: new Date().toLocaleString(),
        to_email: 'ewpmagazine7@gmail.com'
      };

      emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', templateParams)
        .then(() => {
          // Save appointment data
          const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
          appointments.push({
            ...data,
            timestamp: new Date().toISOString(),
            userId: currentUser
          });
          localStorage.setItem('appointments', JSON.stringify(appointments));

          if (successCallback) successCallback();
        })
        .catch((error) => {
          console.error('EmailJS error:', error);
          // Save appointment data even on failure
          const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
          appointments.push({
            ...data,
            timestamp: new Date().toISOString(),
            status: 'pending_email',
            userId: currentUser
          });
          localStorage.setItem('appointments', JSON.stringify(appointments));

          if (errorCallback) errorCallback();
        });
    }

    function previewSchedule() {
      const data = collectFormData();
      if (!data) return;

      const ussdOptions = {
        '1': '1. Book Health Appointment',
        '2': '2. Schedule Transport',
        '3': '3. Community Meeting',
        '4': '4. Book Accommodation',
        '5': '5. View Bookings',
        '0': '0. Exit'
      };
      
      previewBox.classList.remove('hidden');
      previewBox.innerHTML = `
        <h3 class="font-bold mb-2 text-lg font-semibold">Preview Summary</h3>
        <p><strong>Title:</strong> ${data.title}</p>
        <p><strong>Date:</strong> ${data.date}</p>
        <p><strong>Time:</strong> ${data.time}</p>
        <p><strong>Attendees:</strong> ${data.attendees || 'None specified'}</p>
        <p><strong>USSD Option:</strong> ${ussdOptions[data.ussd] || data.ussd}</p>
        <p><strong>Listings:</strong> ${data.listings.join(', ') || 'None'}</p>
      `;
    }

    // Close modals on outside click
    document.addEventListener('click', (e) => {
      if (e.target.id === 'paymentModal') closePaymentModal();
      if (e.target.id === 'confirmationModal') closeConfirmationModal();
      if (e.target.id === 'loginModal') closeAuthModal('loginModal');
      if (e.target.id === 'signupModal') closeAuthModal('signupModal');
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      showTab('scheduler');
      initializeAuth();
    });
  </script>


<!-- INTEGRATED: Admin Dashboard, Profile, USSD Simulator, Toast, Spinner -->
<div class="my-8">
  <ul class="flex border-b mb-4">
    <li><button onclick="showTab('admin')" class="px-4 py-2 font-semibold" id="tab-admin">Admin</button></li>
    <li><button onclick="showTab('profile')" class="px-4 py-2 font-semibold" id="tab-profile">Profile</button></li>
    <li><button onclick="showTab('ussd')" class="px-4 py-2 font-semibold" id="tab-ussd">USSD</button></li>
  </ul>

  <div id="panel-admin" class="mt-6 hidden">
    <div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Admin Dashboard</h2>
      <ul>
        <li>üìä Bookings Today: <span id="analyticsBookings">0</span></li>
        <li>üè® Hotels: <button onclick="alert('Hotel manager coming soon')">Manage</button></li>
        <li>üìÖ All Bookings: <button onclick="alert('Bookings UI coming soon')">View</button></li>
        <li>üë• Users: <button onclick="alert('User manager coming soon')">Manage</button></li>
      </ul>
    </div>
  </div>

  <div id="panel-profile" class="mt-6 hidden">
  <div class="bg-white dark:bg-gray-800 p-6 rounded shadow" id="profileSection">
    <h2 class="text-xl font-bold mb-4">Profile</h2>
    <form class="space-y-4">
      <div>
        <label class="block font-medium">Name</label>
        <input id="editName" class="w-full p-2 rounded border dark:bg-gray-700 dark:border-gray-600" oninput="autoSaveProfile()" />
      </div>
      <div>
        <label class="block font-medium">Email</label>
        <input id="editEmail" class="w-full p-2 rounded border dark:bg-gray-700 dark:border-gray-600" oninput="autoSaveProfile()" />
      </div>
    </form>
    <script>
      function autoSaveProfile() {
        const name = document.getElementById("editName").value;
        const email = document.getElementById("editEmail").value;
        if (name) localStorage.setItem("profileName", name);
        if (email) localStorage.setItem("profileEmail", email);
        showToast("Profile autosaved!");
      }

      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("editName").value = localStorage.getItem("profileName") || "John Doe";
        document.getElementById("editEmail").value = localStorage.getItem("profileEmail") || "john@example.com";
      });
    </script>

  <div id="panel-ussd" class="mt-6 hidden">
    <div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">USSD Simulator</h2>
      <div class="ussd-screen bg-black text-green-400 p-4 rounded font-mono mb-4 min-h-[80px]" id="ussdDisplay">Dial *182# to begin</div>
      <input id="ussdInput" placeholder="Enter option..." class="w-full p-2 mb-2 border rounded dark:bg-gray-700 dark:border-gray-600" />
      <button onclick="handleUSSD()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Send</button>
    </div>
  </div>

  <div id="toastBanner" class="toast fixed hidden right-4 bottom-4 bg-green-500 text-white px-4 py-2 rounded shadow"></div>
</div>

<script>
  function showToast(msg) {
    const toast = document.getElementById('toastBanner');
    toast.textContent = msg;
    toast.classList.remove('hidden');
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 4000);
  }

  function saveProfile() {
    const name = document.getElementById('editName').value;
    const email = document.getElementById('editEmail').value;
    if (name) document.getElementById('profileName').textContent = name;
    if (email) document.getElementById('profileEmail').textContent = email;
    document.getElementById('profileEdit').style.display = 'none';
    showToast('Profile updated!');
  }

  let ussdStep = 0;
  function handleUSSD() {
    const input = document.getElementById('ussdInput').value.trim();
    const display = document.getElementById('ussdDisplay');

    if (ussdStep === 0 && input === '*182#') {
      display.textContent = '1. Book Appointment\n2. Hotel Booking\n0. Exit';
      ussdStep = 1;
    } else if (ussdStep === 1) {
      if (input === '1') {
        display.textContent = 'Enter appointment title:';
        ussdStep = 2;
      } else if (input === '2') {
        display.textContent = 'Enter hotel name:';
        ussdStep = 3;
      } else {
        display.textContent = 'Exited. Dial *182# again.';
        ussdStep = 0;
      }
    } else if (ussdStep >= 2) {
      display.textContent = \`You entered: \${input}\nThank you!\`;
      ussdStep = 0;
    } else {
      display.textContent = 'Invalid input. Dial *182# to try again.';
      ussdStep = 0;
    }
    document.getElementById('ussdInput').value = '';
  }

  function showTab(tab) {
    const panels = ['scheduler', 'mbaza', 'hotels', 'bookings', 'admin', 'profile', 'ussd'];
    panels.forEach(t => {
      const el = document.getElementById('panel-' + t);
      if (el) el.classList.add('hidden');
      const tabBtn = document.getElementById('tab-' + t);
      if (tabBtn) tabBtn.classList.remove('text-blue-500', 'border-b-2', 'border-blue-500');
    });
    const activePanel = document.getElementById('panel-' + tab);
    if (activePanel) activePanel.classList.remove('hidden');
    const activeTab = document.getElementById('tab-' + tab);
    if (activeTab) activeTab.classList.add('text-blue-500', 'border-b-2', 'border-blue-500');
  }
</script>
</body>
</html>
